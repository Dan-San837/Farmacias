{% extends 'base.html' %}

{% block content %}
<h1 class="text-xl font-bold mb-4">Detalle del Pedido</h1>
<p><strong>Cliente:</strong> {{ pedido.cliente.usuario.username }}</p>
<p><strong>Sucursal de Origen:</strong> {{ pedido.sucursal_origen.nombre }}</p>
<p><strong>Estado:</strong> {{ pedido.estado }}</p>

<table class="table-auto border-collapse w-full mt-4">
    <thead>
        <tr class="bg-gray-200">
            <th class="border px-4 py-2">Medicamento</th>
            <th class="border px-4 py-2">Cantidad</th>
            <th class="border px-4 py-2">Subtotal</th>
        </tr>
    </thead>
    <tbody>
        {% for detalle in pedido.detalles.all %}
        <tr>
            <td class="border px-4 py-2">{{ detalle.medicamento.nombre }}</td>
            <td class="border px-4 py-2">{{ detalle.cantidad }}</td>
            <td class="border px-4 py-2">${{ detalle.subtotal }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<p class="mt-4"><strong>Total:</strong> ${{ pedido.total }}</p>
<p><strong>Opción de Entrega:</strong> {{ pedido.get_opcion_entrega_display }}</p>

{% if pedido.opcion_entrega == 'envio' %}
    <p><strong>Sucursal de Origen:</strong> {{ pedido.sucursal_entrega.nombre }}</p>
{% endif %}

<!-- Botón para realizar transferencia de stock si no hay disponibilidad -->
{% if not pedido.stock_disponible %}
    <div class="my-4">
        <a href="{% url 'inventory:transferir_stock' pedido.id %}" class="px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700">
            Transferir desde otra sucursal
        </a>
    </div>
{% endif %}

<div class="my-4">
    <a href="{% url 'sales:ventas_list' %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Volver al Historial
    </a>
</div>
{% endblock %}