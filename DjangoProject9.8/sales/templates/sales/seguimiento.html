{% extends 'base.html' %}

{% block content %}
<h1 class="text-xl font-bold mb-4">Seguimiento de Pedidos</h1>

<!-- Filtros para buscar pedidos -->
<form method="GET" class="mb-4">
    <label for="filtro_cliente">Filtrar por Cliente:</label>
    <input type="text" name="cliente" id="filtro_cliente" class="border p-2">
    <label for="filtro_estado">Filtrar por Estado:</label>
    <select name="estado" id="filtro_estado" class="border p-2">
        <option value="">Todos</option>
        <option value="pendiente">Pendiente</option>
        <option value="en_proceso">En proceso</option>
        <option value="enviado">Enviado</option>
        <option value="entregado">Entregado</option>
    </select>
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Filtrar</button>
</form>

<table class="table-auto border-collapse w-full mt-4">
    <thead>
        <tr class="bg-gray-200">
            <th class="border px-4 py-2">ID Pedido</th>
            <th class="border px-4 py-2">Cliente</th>
            <th class="border px-4 py-2">Estado</th>
            <th class="border px-4 py-2">Fecha</th>
            <th class="border px-4 py-2">Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}
        <tr>
            <td class="border px-4 py-2">{{ pedido.id }}</td>
            <td class="border px-4 py-2">{{ pedido.cliente.usuario.username }}</td>
            <td class="border px-4 py-2">{{ pedido.estado }}</td>
            <td class="border px-4 py-2">{{ pedido.fecha }}</td>
            <td class="border px-4 py-2">
                <a href="{% url 'sales:pedido_detalle' pedido.id %}" class="text-blue-600 hover:underline">Ver Detalle</a>
                {% if pedido.estado != "entregado" %}
                    <form method="POST" action="{% url 'sales:actualizar_estado' pedido.id %}" class="inline">
                        {% csrf_token %}
                        <label>
                            <select name="estado" class="border p-1">
                                <option value="pendiente">Pendiente</option>
                                <option value="en_proceso">En Proceso</option>
                                <option value="entregado">Entregado</option>
                            </select>
                        </label>
                        <button type="submit" class="text-green-600 hover:underline">Actualizar</button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="my-4">
    <a href="{% url 'sales:index' %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        Volver al Inicio
    </a>
</div>
{% endblock %}